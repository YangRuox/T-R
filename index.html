<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Five Personality Test - Complete Version</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2196F3;
            --accent-color: #FF9800;
            --background-color: #f5f5f5;
            --card-background: white;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(to right, rgb(204, 230, 178), rgb(217, 224, 109),rgb(241, 242, 219));
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            background: var(--card-background);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
        }
        
        h2 {
            color: var(--secondary-color);
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 30px;
        }

        
        
        .section {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            box-sizing: border-box; 
            overflow: hidden;
        }

        .section label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #333;
    font-size: 15px;
    clear: both; /* ÂÖ≥ÈîÆÔºöÊØè‰∏™Ê†áÁ≠æÂú®Êñ∞Ë°åÂºÄÂßã */
    width: 100%;
        }

        .section .form-control {
    display: block;
    width: 83%;
    max-width: 800px;
    margin-bottom: 20px; /* Â¢ûÂä†‰∏ãËæπË∑ùÔºåÁ°Æ‰øùÈó¥Ë∑ù */
    padding: 10px 12px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 16px;
    background: white;
        }

        #age {
    width: 80%;
    max-width: 800px;
    margin-bottom: 20px;
        }

        #ideal-job {
    width: 80%;
    max-width: 800px;
    margin-bottom: 20px;
        }

        .section .warning {
    display: block;
    margin: 5px 0 15px 0;
    clear: both;
    width: 100%;
        }

       
        .question {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
            box-sizing: border-box; 
        }
        
        .question:hover {
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-color: var(--primary-color);
        }
        
        .question p {
            margin: 0 0 15px 0;
            font-size: 16px;
            color: #333;
            font-weight: 500;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
        }
        
        .scale-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            color: #666;
            font-size: 13px;
        }
        
        .scale-labels span {
            flex: 1;
            text-align: center;
        }
        
        input[type="range"] {
            flex-grow: 1;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #f89306, #ffd166, #c3e81d);
            border-radius: 3px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .score-display {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            color: var(--primary-color);
            background: #f0f9f0;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #c8e6c9;
            transition: all 0.3s ease;
        }
        
        .form-control {
            width: 70%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        button {
            background: var(--primary-color);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        button:hover {
            background: #3d8b40;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .results-section {
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #f4f5f9 0%, #f7f4fa 100%);
            color: white;
            border-radius: 15px;
        }
        
        .radar-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .career-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .career-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .career-item.top {
            border-left: 4px solid #4CAF50;
        }
        
        .career-item.bottom {
            border-left: 4px solid #f44336;
        }
        
        .rank {
            display: inline-block;
            background: #333;
            color: white;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .progress-bar {
            height: 5px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            border-radius: 3px;
            margin: 20px 0;
            transition: width 0.5s ease;
        }
        
        .disclaimer {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            color: #856404;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .warning {
            color: #f44336;
            padding: 10px;
            margin: 10px 0;
            background: #ffebee;
            border-radius: 5px;
            border-left: 4px solid #f44336;
        }

        
        
        .trait-score {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
            box-sizing: border-box; 
            display: flex;
            justify-content: space-around; 
            align-items: center; 
            width: 100%;
            padding: 14px 25px;
        }
        
        .trait-name {
            font-weight: bold;
            font-size: 18px;
            color: #333;
            margin: 0;
    text-align: left;
    flex: 1; /* Âç†ÊçÆÂâ©‰ΩôÁ©∫Èó¥ */
    padding-right: 30px;
        }
        
        .trait-value {
            font-weight: bold;
            font-size: 18px;
            color: var(--primary-color);
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            border: 2px solid #e0e0e0;
            width: 100px;
            text-align: center !important;
            box-sizing: border-box;
            display: flex;
            flex-shrink: 0;
    margin-left: auto;
    justify-content: center;
    align-items: center;
    

        }


        #scores-title {
    color: #333 !important;
    font-size: 1.4em !important;
    font-weight: 600 !important;
    margin-bottom: 15px !important;
    padding-bottom: 8px;
    border-bottom: 2px solid #4CAF50 !important;
    display: inline-block;
        }

        /* ‰øÆÊîπÂâç10Êé®ËçêËÅå‰∏öÊ†áÈ¢ò */
        #top-careers-title {
    color: #333 !important;
    font-size: 1.4em !important;
    font-weight: 600 !important;
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 2px solid #4CAF50; /* ÁªøËâ≤ËæπÊ°ÜÔºåË°®Á§∫Êé®Ëçê */
        }

        /* ‰øÆÊîπÊúÄ‰∏çÊé®ËçêËÅå‰∏öÊ†áÈ¢ò */
        #bottom-careers-title {
    color: #333 !important;
    font-size: 1.4em !important;
    font-weight: 600 !important;
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 2px solid #f44336; /* Á∫¢Ëâ≤ËæπÊ°ÜÔºåË°®Á§∫‰∏çÊé®Ëçê */
        }
        
        

       
        
       

       
        
        /* Êñ∞Ê∑ªÂä†ÁöÑÂä®ÁîªÊ†∑Âºè */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .question {
            animation: fadeIn 0.3s ease-out;
        }
        
        .language-change-notice {
            position: fixed;
            top: 60px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
            display: none;
        }
    </style>
    <!-- ‰ΩøÁî®Êñ∞Áâà Plotly -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- ÂºïÂÖ• html2canvas Â∫ì -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-3.3.1.min.js" charset="utf-8"></script>

</head>
<body>
   
    <div id="language-change-notice" class="language-change-notice"></div>
    
    
    <div class="language-selector">
        <select id="language-select" class="form-control" style="width: auto; padding: 8px 12px;">
            <option value="en">English</option>
            <option value="zh">‰∏≠Êñá</option>
            <option value="es">Espa√±ol</option>
            <option value="fr">Fran√ßais</option>
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
        </select>
    </div>
    
    <div class="container">
        <h1 id="main-title">Big Five Personality Test</h1>
        
        <form id="personality-form">
            <!-- Demographics Section -->
            <div class="section">
                <h2 id="demographics-title">Demographics</h2>
                
                <label for="gender" id="gender-label">Gender:</label>
                <select id="gender" name="gender" class="form-control">
                    <option value="Female" id="gender-female">Female</option>
                    <option value="Male" id="gender-male">Male</option>
                </select>
                
                <label for="age" id="age-label">Age:</label>
                <input type="number" id="age" name="age" min="18" max="70" value="25" class="form-control">
                
                <div id="age-warning" class="warning" style="display: none;">
                    Please enter an age between 18 and 70
                </div>
                
                <label for="ideal-job" id="ideal-job-label">Your ideal career (e.g., Data Scientist):</label>
                <input type="text" id="ideal-job" name="ideal-job" placeholder="e.g., Data Scientist" class="form-control">
                <div id="ideal-job-warning" class="warning" style="display: none;">
                    ‚ö†Ô∏è Please enter your ideal career.
                </div>
            </div>
            
            <!-- Questions Section -->
            <div class="section">
                <h2 id="questions-title">Personality Assessment</h2>
                <p id="instructions">Please read each statement and indicate how much you agree or disagree using the following scale:</p>
                
                <div id="questions-container">
                    <!-- Questions will be dynamically loaded here -->
                </div>
                
                <div id="questions-warning" class="warning" style="display: none;">
                    Please answer all questions before submitting
                </div>
            </div>
            
            <button type="submit" id="submit-btn">Submit Test</button>
        </form>
        
        <!-- Loading State -->
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p id="loading-text">Processing your results...</p>
        </div>
        
        <!-- Results Section -->
        <div id="results" style="display: none;">
            <div class="results-section">
                <h2 id="results-title">Your Personality Profile</h2>
                
                <!-- Personality Scores -->
                <div class="section" style="background: #ffff;">
                    <h3 id="scores-title">Your Big Five Scores (T-scores)</h3>
                    <div id="trait-scores-container"></div>
                </div>
                
                
                
                <!-- Radar Chart -->
                <div class="radar-container">
                    <div id="radar-chart" style="width: 100%; height: 400px;"></div>
                </div>
                
                <!-- Career Recommendations -->
                <h3 id="top-careers-title">Top 10 Recommended Careers</h3>
                <div id="top-careers" class="career-list"></div>
                
                <h3 id="bottom-careers-title">10 Least Recommended Careers</h3>
                <div id="bottom-careers" class="career-list"></div>
                
                <!-- Disclaimer -->
                <div class="disclaimer">
                    <h4 id="disclaimer-title">Important Note</h4>
                    <p id="disclaimer-text"></p>
                </div>
                
                <!-- Download Button -->
                <button id="download-btn" onclick="generatePDF()">Download PDF Report</button>
                
                <!-- Restart Button -->
                <button id="restart-btn" onclick="restartTest()" style="margin-left: 10px; background: var(--secondary-color);">Take Test Again</button>
            </div>
        </div>
    </div>

    <script>
        // ==================== ÂÖ®Â±ÄÂèòÈáè ====================
        let appData = null;
        let currentLanguage = 'en';
        let userResponses = {};
        let personalityScores = null;
        let jobRecommendations = [];
        let isInitialized = false;

        // ==================== ËØ≠Ë®ÄÁøªËØëÊï∞ÊçÆ ====================
        const translations = {
            en: {
                mainTitle: "Big Five Personality Test",
                demographicsTitle: "Demographics",
                genderLabel: "Gender:",
                genderFemale: "Female",
                genderMale: "Male",
                ageLabel: "Age:",
                ageWarning: "Please enter an age between 18 and 70",
                idealJobLabel: "Your ideal career (e.g., Data Scientist):",
                idealJobWarning: "‚ö†Ô∏è Please enter your ideal career.",
                questionsTitle: "Personality Assessment",
                instructions: "Please read each statement and indicate how much you agree or disagree using the following scale:",
                questionsWarning: "Please answer all questions before submitting",
                submitBtn: "Submit Test",
                loadingText: "Processing your results...",
                resultsTitle: "Your Personality Profile",
                scoresTitle: "Your Big Five Scores (T-scores)",
                topCareersTitle: "Top 10 Recommended Careers",
                bottomCareersTitle: "10 Least Recommended Careers",
                disclaimerTitle: "Important Note",
                disclaimerText: "The career recommendations provided here are for your reference only. It's important to consider your personal circumstances, preferences, and goals when making a career decision.",
                downloadBtn: "Download PDF Report",
                restartBtn: "Take Test Again",
                scaleLabels: ["Strongly Disagree", "Disagree", "Slightly Disagree", "Slightly Agree", "Agree", "Strongly Agree"],
                languageChanged: "Language changed to English",
                careerMatchTitle: "Career Match",
        noCareerData: "No career recommendation data",
        compositeMatch: "Composite Match",
        similarity: "Similarity",
        mlpScore: "MLP Score"
            },
            zh: {
                mainTitle: "‰∫îÂ§ß‰∫∫Ê†ºÊµãËØï",
                demographicsTitle: "Âü∫Êú¨‰ø°ÊÅØ",
                genderLabel: "ÊÄßÂà´Ôºö",
                genderFemale: "Â•≥",
                genderMale: "Áî∑",
                ageLabel: "Âπ¥ÈæÑÔºö",
                ageWarning: "ËØ∑ËæìÂÖ•18-70Â≤Å‰πãÈó¥ÁöÑÂπ¥ÈæÑ",
                idealJobLabel: "ÊÇ®ÁöÑÁêÜÊÉ≥ËÅå‰∏öÔºà‰æãÂ¶ÇÔºöÊï∞ÊçÆÁßëÂ≠¶ÂÆ∂ÔºâÔºö",
                idealJobWarning: "‚ö†Ô∏è ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÁêÜÊÉ≥ËÅå‰∏ö„ÄÇ",
                questionsTitle: "‰∫∫Ê†ºËØÑ‰º∞",
                instructions: "ËØ∑ÈòÖËØª‰ª•‰∏ãÈôàËø∞ÔºåÂπ∂‰ΩøÁî®1-6ÂàÜË°®Á§∫ÊÇ®ÂêåÊÑèÊàñ‰∏çÂêåÊÑèÁöÑÁ®ãÂ∫¶Ôºö",
                questionsWarning: "ËØ∑ÂõûÁ≠îÊâÄÊúâÈóÆÈ¢òÂêéÂÜçÊèê‰∫§",
                submitBtn: "Êèê‰∫§ÊµãËØï",
                loadingText: "Ê≠£Âú®Â§ÑÁêÜÊÇ®ÁöÑÁªìÊûú...",
                resultsTitle: "ÊÇ®ÁöÑ‰∫∫Ê†ºÊ¶ÇÂÜµ",
                scoresTitle: "ÊÇ®ÁöÑ‰∫îÂ§ß‰∫∫Ê†ºÂàÜÊï∞ÔºàTÂàÜÊï∞Ôºâ",
                topCareersTitle: "Ââç10‰∏™Êé®ËçêËÅå‰∏ö",
                bottomCareersTitle: "10‰∏™ÊúÄ‰∏çÊé®ËçêËÅå‰∏ö",
                disclaimerTitle: "ÈáçË¶ÅÊèêÁ§∫",
                disclaimerText: "ËøôÈáåÊèê‰æõÁöÑËÅå‰∏öÊé®Ëçê‰ªÖ‰æõÂèÇËÄÉ„ÄÇÂú®ÂÅöÂá∫ËÅå‰∏öÈÄâÊã©Êó∂ÔºåËØ∑Âä°ÂøÖËÄÉËôëÊÇ®ÁöÑ‰∏™‰∫∫ÊÉÖÂÜµ„ÄÅÂÖ¥Ë∂£ÂíåÁõÆÊ†á„ÄÇ",
                downloadBtn: "‰∏ãËΩΩPDFÊä•Âëä",
                restartBtn: "ÈáçÊñ∞ÊµãËØï",
                scaleLabels: ["ÈùûÂ∏∏‰∏çÂêåÊÑè", "‰∏çÂêåÊÑè", "ÊúâÁÇπ‰∏çÂêåÊÑè", "ÊúâÁÇπÂêåÊÑè", "ÂêåÊÑè", "ÈùûÂ∏∏ÂêåÊÑè"],
                languageChanged: "ËØ≠Ë®ÄÂ∑≤ÂàáÊç¢‰∏∫‰∏≠Êñá",
                careerMatchTitle: "ËÅå‰∏öÂåπÈÖç",
        noCareerData: "ÊöÇÊó†ËÅå‰∏öÊé®ËçêÊï∞ÊçÆ",
        compositeMatch: "ÁªºÂêàÂåπÈÖçÂ∫¶",
        similarity: "Áõ∏‰ººÂ∫¶",
        mlpScore: "MLPÈ¢ÑÊµã"
            },
            es: {
                mainTitle: "Test de Personalidad Big Five",
                demographicsTitle: "Datos Demogr√°ficos",
                genderLabel: "G√©nero:",
                genderFemale: "Femenino",
                genderMale: "Masculino",
                ageLabel: "Edad:",
                ageWarning: "Por favor ingrese una edad entre 18 y 70",
                idealJobLabel: "Tu carrera ideal (ej: Cient√≠fico de Datos):",
                idealJobWarning: "‚ö†Ô∏è Por favor ingresa tu carrera ideal.",
                questionsTitle: "Evaluaci√≥n de Personalidad",
                instructions: "Por favor lee cada afirmaci√≥n e indica cu√°nto est√°s de acuerdo o en desacuerdo usando la siguiente escala:",
                questionsWarning: "Por favor responde todas las preguntas antes de enviar",
                submitBtn: "Enviar Test",
                loadingText: "Procesando tus resultados...",
                resultsTitle: "Tu Perfil de Personalidad",
                scoresTitle: "Tus Puntajes Big Five (Puntajes T)",
                topCareersTitle: "Top 10 Carreras Recomendadas",
                bottomCareersTitle: "10 Carreras Menos Recomendadas",
                disclaimerTitle: "Nota Importante",
                disclaimerText: "Las recomendaciones de carrera proporcionadas aqu√≠ son solo para tu referencia. Es importante considerar tus circunstancias personales, preferencias y objetivos al tomar una decisi√≥n de carrera.",
                downloadBtn: "Descargar Reporte PDF",
                restartBtn: "Hacer el Test de Nuevo",
                scaleLabels: ["Muy en desacuerdo", "En desacuerdo", "Algo en desacuerdo", "Algo de acuerdo", "De acuerdo", "Muy de acuerdo"],
                languageChanged: "Idioma cambiado a Espa√±ol",
                 careerMatchTitle: "Coincidencia de Carrera",
        noCareerData: "No hay datos de recomendaci√≥n de carrera",
        compositeMatch: "Coincidencia Compuesta",
        similarity: "Similitud",
        mlpScore: "Puntuaci√≥n MLP"
            },
            fr: {
                mainTitle: "Test de Personnalit√© Big Five",
                demographicsTitle: "D√©mographie",
                genderLabel: "Genre:",
                genderFemale: "Femme",
                genderMale: "Homme",
                ageLabel: "√Çge:",
                ageWarning: "Veuillez entrer un √¢ge entre 18 et 70 ans",
                idealJobLabel: "Votre m√©tier id√©al (ex: Data Scientist):",
                idealJobWarning: "‚ö†Ô∏è Veuillez entrer votre m√©tier id√©al.",
                questionsTitle: "√âvaluation de la Personnalit√©",
                instructions: "Veuillez lire chaque affirmation et indiquer dans quelle mesure vous √™tes d'accord ou non en utilisant l'√©chelle suivante:",
                questionsWarning: "Veuillez r√©pondre √† toutes les questions avant de soumettre",
                submitBtn: "Soumettre le Test",
                loadingText: "Traitement de vos r√©sultats...",
                resultsTitle: "Votre Profil de Personnalit√©",
                scoresTitle: "Vos Scores Big Five (scores T)",
                topCareersTitle: "Top 10 M√©tiers Recommand√©s",
                bottomCareersTitle: "10 M√©tiers D√©conseill√©s",
                disclaimerTitle: "Note Importante",
                disclaimerText: "Les recommandations de carri√®re fournies ici sont uniquement √† titre indicatif. Il est important de prendre en compte vos circonstances personnelles, vos pr√©f√©rences et vos objectifs lors d'une d√©cision de carri√®re.",
                downloadBtn: "T√©l√©charger le Rapport PDF",
                restartBtn: "Refaire le Test",
                scaleLabels: ["Pas du tout d'accord", "Pas d'accord", "Plut√¥t pas d'accord", "Plut√¥t d'accord", "D'accord", "Tout √† fait d'accord"],
                languageChanged: "Langue chang√©e en Fran√ßais",
                careerMatchTitle: "Correspondance de Carri√®re",
        noCareerData: "Aucune donn√©e de recommandation de carri√®re",
        compositeMatch: "Correspondance Composite",
        similarity: "Similitude",
        mlpScore: "Score MLP"
            },
            ru: {
                mainTitle: "–¢–µ—Å—Ç –ª–∏—á–Ω–æ—Å—Ç–∏ Big Five",
                demographicsTitle: "–î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ",
                genderLabel: "–ü–æ–ª:",
                genderFemale: "–ñ–µ–Ω—Å–∫–∏–π",
                genderMale: "–ú—É–∂—Å–∫–æ–π",
                ageLabel: "–í–æ–∑—Ä–∞—Å—Ç:",
                ageWarning: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç –æ—Ç 18 –¥–æ 70 –ª–µ—Ç",
                idealJobLabel: "–í–∞—à–∞ –∏–¥–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, Data Scientist):",
                idealJobWarning: "‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –∏–¥–µ–∞–ª—å–Ω—É—é –ø—Ä–æ—Ñ–µ—Å—Å–∏—é.",
                questionsTitle: "–û—Ü–µ–Ω–∫–∞ –ª–∏—á–Ω–æ—Å—Ç–∏",
                instructions: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –∫–∞–∂–¥–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ —É–∫–∞–∂–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤—ã —Å–æ–≥–ª–∞—Å–Ω—ã –∏–ª–∏ –Ω–µ —Å–æ–≥–ª–∞—Å–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É—è —Å–ª–µ–¥—É—é—â—É—é —à–∫–∞–ª—É:",
                questionsWarning: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π",
                submitBtn: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç",
                loadingText: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∞—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...",
                resultsTitle: "–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –ª–∏—á–Ω–æ—Å—Ç–∏",
                scoresTitle: "–í–∞—à–∏ –±–∞–ª–ª—ã –ø–æ Big Five (T-–±–∞–ª–ª—ã)",
                topCareersTitle: "–¢–æ–ø 10 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–π",
                bottomCareersTitle: "10 –Ω–µ—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–π",
                disclaimerTitle: "–í–∞–∂–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ",
                disclaimerText: "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–∞—Ä—å–µ—Ä–µ, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–¥–µ—Å—å, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏. –ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∫–∞—Ä—å–µ—Ä–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –≤–∞–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –≤–∞—à–∏ –ª–∏—á–Ω—ã–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∏ —Ü–µ–ª–∏.",
                downloadBtn: "–°–∫–∞—á–∞—Ç—å PDF –æ—Ç—á–µ—Ç",
                restartBtn: "–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç —Å–Ω–æ–≤–∞",
                scaleLabels: ["–ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω", "–ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω", "–°–∫–æ—Ä–µ–µ –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω", "–°–∫–æ—Ä–µ–µ —Å–æ–≥–ª–∞—Å–µ–Ω", "–°–æ–≥–ª–∞—Å–µ–Ω", "–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–µ–Ω"],
                languageChanged: "–Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ –†—É—Å—Å–∫–∏–π",
                careerMatchTitle: "–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∫–∞—Ä—å–µ—Ä—ã",
        noCareerData: "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö –ø–æ –∫–∞—Ä—å–µ—Ä–µ",
        compositeMatch: "–°–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ",
        similarity: "–°—Ö–æ–¥—Å—Ç–≤–æ",
        mlpScore: "–û—Ü–µ–Ω–∫–∞ MLP"

            },
            ar: {
                mainTitle: "ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿ¥ÿÆÿµŸäÿ© Big Five",
                demographicsTitle: "ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿØŸäŸÖŸàÿ∫ÿ±ÿßŸÅŸäÿ©",
                genderLabel: "ÿßŸÑÿ¨ŸÜÿ≥:",
                genderFemale: "ÿ£ŸÜÿ´Ÿâ",
                genderMale: "ÿ∞ŸÉÿ±",
                ageLabel: "ÿßŸÑÿπŸÖÿ±:",
                ageWarning: "ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿπŸÖÿ± ÿ®ŸäŸÜ 18 Ÿà 70",
                idealJobLabel: "ŸÖŸáŸÜÿ™ŸÉ ÿßŸÑŸÖÿ´ÿßŸÑŸäÿ© (ŸÖÿ´ÿßŸÑ: ÿπÿßŸÑŸÖ ÿ®ŸäÿßŸÜÿßÿ™):",
                idealJobWarning: "‚ö†Ô∏è ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ŸÖŸáŸÜÿ™ŸÉ ÿßŸÑŸÖÿ´ÿßŸÑŸäÿ©.",
                questionsTitle: "ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¥ÿÆÿµŸäÿ©",
                instructions: "ÿßŸÑÿ±ÿ¨ÿßÿ° ŸÇÿ±ÿßÿ°ÿ© ŸÉŸÑ ÿπÿ®ÿßÿ±ÿ© ŸàÿßŸÑÿ•ÿ¥ÿßÿ±ÿ© ÿ•ŸÑŸâ ŸÖÿØŸâ ŸÖŸàÿßŸÅŸÇÿ™ŸÉ ÿ£Ÿà ÿπÿØŸÖ ŸÖŸàÿßŸÅŸÇÿ™ŸÉ ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÖŸÇŸäÿßÿ≥ ÿßŸÑÿ™ÿßŸÑŸä:",
                questionsWarning: "ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ© ŸÇÿ®ŸÑ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ",
                submitBtn: "ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±",
                loadingText: "ŸÖÿπÿßŸÑÿ¨ÿ© ŸÜÿ™ÿßÿ¶ÿ¨ŸÉ...",
                resultsTitle: "ŸÖŸÑŸÅŸÉ ÿßŸÑÿ¥ÿÆÿµŸä",
                scoresTitle: "ÿØÿ±ÿ¨ÿßÿ™ŸÉ ŸÅŸä Big Five (ÿØÿ±ÿ¨ÿßÿ™ T)",
                topCareersTitle: "ÿ£ŸÅÿ∂ŸÑ 10 ŸÖŸáŸÜ ŸÖŸàÿµŸâ ÿ®Ÿáÿß",
                bottomCareersTitle: "10 ŸÖŸáŸÜ ÿ∫Ÿäÿ± ŸÖŸàÿµŸâ ÿ®Ÿáÿß",
                disclaimerTitle: "ŸÖŸÑÿßÿ≠ÿ∏ÿ© ŸáÿßŸÖÿ©",
                disclaimerText: "ÿ™ŸàÿµŸäÿßÿ™ ÿßŸÑŸÖŸáŸÜÿ© ÿßŸÑŸÖŸÇÿØŸÖÿ© ŸáŸÜÿß ŸáŸä ŸÑŸÑÿ±ÿ¨Ÿàÿπ ÿ•ŸÑŸäŸáÿß ŸÅŸÇÿ∑. ŸÖŸÜ ÿßŸÑŸÖŸáŸÖ ŸÖÿ±ÿßÿπÿßÿ© ÿ∏ÿ±ŸàŸÅŸÉ ÿßŸÑÿ¥ÿÆÿµŸäÿ© Ÿàÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ŸÉ Ÿàÿ£ŸáÿØÿßŸÅŸÉ ÿπŸÜÿØ ÿßÿ™ÿÆÿßÿ∞ ŸÇÿ±ÿßÿ± ŸÖŸáŸÜŸä.",
                downloadBtn: "ÿ™ŸÜÿ≤ŸäŸÑ ÿ™ŸÇÿ±Ÿäÿ± PDF",
                restartBtn: "ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ±",
                scaleLabels: ["ŸÑÿß ÿ£ŸàÿßŸÅŸÇ ÿ®ÿ¥ÿØÿ©", "ŸÑÿß ÿ£ŸàÿßŸÅŸÇ", "ŸÑÿß ÿ£ŸàÿßŸÅŸÇ ÿ•ŸÑŸâ ÿ≠ÿØ ŸÖÿß", "ÿ£ŸàÿßŸÅŸÇ ÿ•ŸÑŸâ ÿ≠ÿØ ŸÖÿß", "ÿ£ŸàÿßŸÅŸÇ", "ÿ£ŸàÿßŸÅŸÇ ÿ®ÿ¥ÿØÿ©"],
                languageChanged: "ÿ™ŸÖ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ© ÿ•ŸÑŸâ ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",
                careerMatchTitle: "ŸÖÿ∑ÿßÿ®ŸÇÿ© ÿßŸÑŸÖŸáŸÜÿ©",
        noCareerData: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ŸàÿµŸäÿßÿ™ ŸÖŸáŸÜŸäÿ©",
        compositeMatch: "ŸÖÿ∑ÿßÿ®ŸÇÿ© ŸÖÿ±ŸÉÿ®ÿ©",
        similarity: "ÿ™ÿ¥ÿßÿ®Ÿá",
        mlpScore: "ŸÜÿ™Ÿäÿ¨ÿ© MLP"
            }
        };

        
        (function initializePage() {
            console.log(' È°µÈù¢ÂàùÂßãÂåñÂºÄÂßã...');
            
            
            const savedLanguage = localStorage.getItem('big5_language');
            if (savedLanguage && translations[savedLanguage]) {
                currentLanguage = savedLanguage;
            }
            
          
            setTimeout(() => {
                const languageSelect = document.getElementById('language-select');
                if (languageSelect) {
                    languageSelect.value = currentLanguage;
                }
            }, 100);
            
           
            loadAppData();
            
            // ÁõëÂê¨DOMÂä†ËΩΩÂÆåÊàê
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', onDOMContentLoaded);
            } else {
                onDOMContentLoaded();
            }
        })();

       
        function onDOMContentLoaded() {
            console.log('üìÑ DOMÂä†ËΩΩÂÆåÊàê');
            
            
            setupEventListeners();
            
            
            updateLanguageUI();
            
            isInitialized = true;
            console.log('‚úÖ È°µÈù¢ÂàùÂßãÂåñÂÆåÊàê');
        }

        async function loadAppData() {
            console.log('ÂºÄÂßãÂä†ËΩΩÂ∫îÁî®Êï∞ÊçÆ...');
            
            try {
                
                const possiblePaths = [
                    'app_data_complete.json',
                    './app_data_complete.json',
                    'data/app_data_complete.json'
                ];
                
                let dataLoaded = false;
                
                for (const path of possiblePaths) {
                    try {
                        const response = await fetch(path);
                        if (response.ok) {
                            appData = await response.json();
                            console.log(`‚úÖ Êï∞ÊçÆ‰ªé ${path} Âä†ËΩΩÊàêÂäü`);
                            console.log('Êï∞ÊçÆÁªüËÆ°:', {
                                ËÅå‰∏öÊï∞Èáè: appData.n_jobs || 'Êú™Áü•',
                                ÈóÆÈ¢òÊï∞Èáè: appData.n_questions || 'Êú™Áü•',
                                ÊîØÊåÅËØ≠Ë®Ä: appData.languages_supported || 'Êú™Áü•',
                                ÊòØÂê¶ÊúâÈóÆÈ¢òÊï∞ÊçÆ: !!(appData.questions && Object.keys(appData.questions).length > 0)
                            });
                            dataLoaded = true;
                            break;
                        }
                    } catch (e) {
                        console.log(`Ë∑ØÂæÑ ${path} Âä†ËΩΩÂ§±Ë¥•: ${e.message}`);
                    }
                }
                
                if (!dataLoaded) {
                    console.warn('üìÇ Êó†Ê≥ï‰ªé‰ªª‰ΩïË∑ØÂæÑÂä†ËΩΩÊï∞ÊçÆÔºå‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆ');
                    appData = getDefaultData();
                }
                
                // Á°Æ‰øùÈóÆÈ¢òÊï∞ÊçÆÂ≠òÂú®
                ensureQuestionData();
                
               
                if (document.readyState !== 'loading') {
                    initializeQuestions();
                }
                
            } catch (error) {
                console.error('‚ùå Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                appData = getDefaultData();
                ensureQuestionData();
                
                if (document.readyState !== 'loading') {
                    initializeQuestions();
                }
            }
        }

        
        function ensureQuestionData() {
            if (!appData.questions) {
                appData.questions = {};
            }
            
           
            Object.keys(translations).forEach(lang => {
                if (!appData.questions[lang] || !Array.isArray(appData.questions[lang])) {
                    appData.questions[lang] = generateDefaultQuestions(lang, 74);
                }
                
                
                while (appData.questions[lang].length < 74) {
                    appData.questions[lang].push(`${translations[lang].questionsTitle} ${appData.questions[lang].length + 1}`);
                }
            });
        }

        
        function generateDefaultQuestions(lang, count) {
            const templates = {
                en: [
                    "I am the life of the party.",
                    "I feel little concern for others.",
                    "I am always prepared.",
                    "I get stressed out easily.",
                    "I have a rich vocabulary.",
                    "I don't talk a lot.",
                    "I am interested in people.",
                    "I leave my belongings around.",
                    "I am relaxed most of the time.",
                    "I have difficulty understanding abstract ideas."
                ],
                zh: [
                    "ÊàëÊòØÊ¥æÂØπÁöÑ‰∏≠ÂøÉ‰∫∫Áâ©„ÄÇ",
                    "Êàë‰∏çÂ§™ÂÖ≥ÂøÉ‰ªñ‰∫∫„ÄÇ",
                    "ÊàëÊÄªÊòØÂÅöÂ•ΩÂáÜÂ§á„ÄÇ",
                    "ÊàëÂæàÂÆπÊòìÊÑüÂà∞ÂéãÂäõ„ÄÇ",
                    "ÊàëÊúâ‰∏∞ÂØåÁöÑËØçÊ±áÈáè„ÄÇ",
                    "Êàë‰∏çÂ§™Áà±ËØ¥ËØù„ÄÇ",
                    "ÊàëÂØπ‰∫∫ÊÑüÂÖ¥Ë∂£„ÄÇ",
                    "ÊàëÊää‰∏úË•ø‰π±Êîæ„ÄÇ",
                    "ÊàëÂ§ßÈÉ®ÂàÜÊó∂Èó¥ÈÉΩÂæàÊîæÊùæ„ÄÇ",
                    "ÊàëÈöæ‰ª•ÁêÜËß£ÊäΩË±°Ê¶ÇÂøµ„ÄÇ"
                ],
                es: [
                    "Soy el alma de la fiesta.",
                    "Siento poca preocupaci√≥n por los dem√°s.",
                    "Siempre estoy preparado.",
                    "Me estreso f√°cilmente.",
                    "Tengo un vocabulario rico.",
                    "No hablo mucho.",
                    "Me interesa la gente.",
                    "Dejo mis pertenencias por ah√≠.",
                    "Estoy relajado la mayor parte del tiempo.",
                    "Tengo dificultad para entender ideas abstractas."
                ],
                fr: [
                    "Je suis l'√¢me de la f√™te.",
                    "Je me soucie peu des autres.",
                    "Je suis toujours pr√©par√©.",
                    "Je suis facilement stress√©.",
                    "J'ai un vocabulaire riche.",
                    "Je ne parle pas beaucoup.",
                    "Je m'int√©resse aux gens.",
                    "Je laisse tra√Æner mes affaires.",
                    "Je suis d√©tendu la plupart du temps.",
                    "J'ai du mal √† comprendre les id√©es abstraites."
                ],
                ru: [
                    "–Ø –¥—É—à–∞ –∫–æ–º–ø–∞–Ω–∏–∏.",
                    "–Ø –º–∞–ª–æ –±–µ—Å–ø–æ–∫–æ—é—Å—å –æ –¥—Ä—É–≥–∏—Ö.",
                    "–Ø –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤.",
                    "–Ø –ª–µ–≥–∫–æ –Ω–µ—Ä–≤–Ω–∏—á–∞—é.",
                    "–£ –º–µ–Ω—è –±–æ–≥–∞—Ç—ã–π —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å.",
                    "–Ø –º–∞–ª–æ —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—é.",
                    "–ú–Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã –ª—é–¥–∏.",
                    "–Ø —Ä–∞–∑–±—Ä–∞—Å—ã–≤–∞—é —Å–≤–æ–∏ –≤–µ—â–∏.",
                    "–Ø —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω –±–æ–ª—å—à—É—é —á–∞—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏.",
                    "–ú–Ω–µ —Ç—Ä—É–¥–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∏–¥–µ–∏."
                ],
                ar: [
                    "ÿ£ŸÜÿß ÿ±Ÿàÿ≠ ÿßŸÑÿ≠ŸÅŸÑÿ©.",
                    "ÿ£ÿ¥ÿπÿ± ÿ®ŸÇŸÑŸäŸÑ ŸÖŸÜ ÿßŸÑÿßŸáÿ™ŸÖÿßŸÖ ÿ®ÿßŸÑÿ¢ÿÆÿ±ŸäŸÜ.",
                    "ÿ£ŸÜÿß ÿØÿßÿ¶ŸÖŸãÿß ŸÖÿ≥ÿ™ÿπÿØ.",
                    "ÿ£ÿ¥ÿπÿ± ÿ®ÿßŸÑÿ™Ÿàÿ™ÿ± ÿ®ÿ≥ŸáŸàŸÑÿ©.",
                    "ŸÑÿØŸä ŸÖŸÅÿ±ÿØÿßÿ™ ÿ∫ŸÜŸäÿ©.",
                    "ŸÑÿß ÿ£ÿ™ÿ≠ÿØÿ´ ŸÉÿ´Ÿäÿ±Ÿãÿß.",
                    "ÿ£ŸÜÿß ŸÖŸáÿ™ŸÖ ÿ®ÿßŸÑŸÜÿßÿ≥.",
                    "ÿ£ÿ™ÿ±ŸÉ ŸÖŸÖÿ™ŸÑŸÉÿßÿ™Ÿä ŸÅŸä ŸÉŸÑ ŸÖŸÉÿßŸÜ.",
                    "ÿ£ŸÜÿß ŸÖÿ≥ÿ™ÿ±ÿÆŸä ŸÖÿπÿ∏ŸÖ ÿßŸÑŸàŸÇÿ™.",
                    "ÿ£ÿ¨ÿØ ÿµÿπŸàÿ®ÿ© ŸÅŸä ŸÅŸáŸÖ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ÿßŸÑŸÖÿ¨ÿ±ÿØÿ©."
                ]
            };
            
            const baseQuestions = templates[lang] || templates.en;
            const questions = [];
            
            for (let i = 0; i < count; i++) {
                if (i < baseQuestions.length) {
                    questions.push(baseQuestions[i]);
                } else {
                    questions.push(`${translations[lang]?.questionsTitle || 'Question'} ${i + 1}`);
                }
            }
            
            return questions;
        }

    
        function getDefaultData() {
            console.log('‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆÈõÜ');
            
           
            const questions = {};
            Object.keys(translations).forEach(lang => {
                questions[lang] = generateDefaultQuestions(lang, 74);
            });
            
            return {
                questions: questions,
                mean_norms: {
                    1: Array(74).fill(4.0),
                    2: Array(74).fill(4.0),
                    3: Array(74).fill(4.0),
                    4: Array(74).fill(4.0)
                },
                sd_norms: {
                    1: Array(74).fill(1.0),
                    2: Array(74).fill(1.0),
                    3: Array(74).fill(1.0),
                    4: Array(74).fill(1.0)
                },
                weights: Array(74).fill().map(() => [
                    Math.random() * 0.5 - 0.25,
                    Math.random() * 0.5 - 0.25,
                    Math.random() * 0.5 - 0.25,
                    Math.random() * 0.5 - 0.25,
                    Math.random() * 0.5 - 0.25
                ]),
                job_translations: {
                    en: ["Data Scientist", "Psychologist", "Teacher", "Engineer", "Artist", 
                         "Doctor", "Lawyer", "Accountant", "Designer", "Manager"],
                    zh: ["Êï∞ÊçÆÁßëÂ≠¶ÂÆ∂", "ÂøÉÁêÜÂ≠¶ÂÆ∂", "ÊïôÂ∏à", "Â∑•Á®ãÂ∏à", "Ëâ∫ÊúØÂÆ∂",
                         "ÂåªÁîü", "ÂæãÂ∏à", "‰ºöËÆ°Â∏à", "ËÆæËÆ°Â∏à", "ÁªèÁêÜ"],
                    es: ["Cient√≠fico de Datos", "Psic√≥logo", "Profesor", "Ingeniero", "Artista",
                         "Doctor", "Abogado", "Contador", "Dise√±ador", "Gerente"],
                    fr: ["Scientifique des Donn√©es", "Psychologue", "Enseignant", "Ing√©nieur", "Artiste",
                         "M√©decin", "Avocat", "Comptable", "Designer", "Manager"],
                    ru: ["–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –¥–∞–Ω–Ω—ã–º", "–ü—Å–∏—Ö–æ–ª–æ–≥", "–£—á–∏—Ç–µ–ª—å", "–ò–Ω–∂–µ–Ω–µ—Ä", "–•—É–¥–æ–∂–Ω–∏–∫",
                         "–í—Ä–∞—á", "–ê–¥–≤–æ–∫–∞—Ç", "–ë—É—Ö–≥–∞–ª—Ç–µ—Ä", "–î–∏–∑–∞–π–Ω–µ—Ä", "–ú–µ–Ω–µ–¥–∂–µ—Ä"],
                    ar: ["ÿπÿßŸÑŸÖ ÿ®ŸäÿßŸÜÿßÿ™", "ÿ∑ÿ®Ÿäÿ® ŸÜŸÅÿ≥Ÿä", "ŸÖÿπŸÑŸÖ", "ŸÖŸáŸÜÿØÿ≥", "ŸÅŸÜÿßŸÜ",
                         "ÿ∑ÿ®Ÿäÿ®", "ŸÖÿ≠ÿßŸÖŸä", "ŸÖÿ≠ÿßÿ≥ÿ®", "ŸÖÿµŸÖŸÖ", "ŸÖÿØŸäÿ±"]
                },
                job_codes: ['1000', '101x', '1221', '200x', '2221', 
                          '2300', '2310', '2411', '3313', '3322'],
                scaled_features: [
                    [50, 50, 50, 50, 50],
                    [60, 40, 55, 70, 45],
                    [45, 60, 40, 75, 65],
                    [40, 55, 65, 40, 75],
                    [55, 65, 80, 50, 35],
                    [65, 45, 40, 70, 80],
                    [55, 70, 50, 30, 85],
                    [40, 40, 35, 45, 90],
                    [50, 60, 85, 55, 45],
                    [60, 75, 55, 60, 70]
                ],
                n_jobs: 10,
                n_questions: 74,
                languages_supported: ['en', 'zh', 'es', 'fr', 'ru', 'ar'],
                is_default_data: true
            };
        }

        // ==================== ËØ≠Ë®ÄÁÆ°ÁêÜ ====================
        // Êõ¥Êñ∞ËØ≠Ë®ÄUI
        function updateLanguageUI() {
            console.log(`Êõ¥Êñ∞ËØ≠Ë®ÄUI: ${currentLanguage}`);
            
            const texts = translations[currentLanguage] || translations.en;
            
            // ÊâπÈáèÊõ¥Êñ∞ÊñáÊú¨ÂÜÖÂÆπ
            const elementsToUpdate = {
                'main-title': texts.mainTitle,
                'demographics-title': texts.demographicsTitle,
                'gender-label': texts.genderLabel,
                'gender-female': texts.genderFemale,
                'gender-male': texts.genderMale,
                'age-label': texts.ageLabel,
                'ideal-job-label': texts.idealJobLabel,
                'questions-title': texts.questionsTitle,
                'instructions': texts.instructions,
                'submit-btn': texts.submitBtn,
                'loading-text': texts.loadingText,
                'results-title': texts.resultsTitle,
                'scores-title': texts.scoresTitle,
                'top-careers-title': texts.topCareersTitle,
                'bottom-careers-title': texts.bottomCareersTitle,
                'disclaimer-title': texts.disclaimerTitle,
                'disclaimer-text': texts.disclaimerText,
                'download-btn': texts.downloadBtn,
                'restart-btn': texts.restartBtn,
                
            };
            
            Object.keys(elementsToUpdate).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = elementsToUpdate[id];
                }
            });
            
            
            const warnings = {
                'age-warning': texts.ageWarning,
                'ideal-job-warning': texts.idealJobWarning,
                'questions-warning': texts.questionsWarning
            };
            
            Object.keys(warnings).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = warnings[id];
                }
            });
            
            
            if (isInitialized) {
                initializeQuestions();
            }
        }
     
        function updateResultsLanguage() {
    console.log(`üîÑ Êõ¥Êñ∞ÁªìÊûúÈ°µÈù¢ËØ≠Ë®Ä: ${currentLanguage}`);
    
    const texts = translations[currentLanguage] || translations.en;
    
    // Êõ¥Êñ∞ÁªìÊûúÈ°µÈù¢ÁöÑÊâÄÊúâÊñáÊú¨
    const elementsToUpdate = {
        'results-title': texts.resultsTitle,
        'scores-title': texts.scoresTitle,
        'top-careers-title': texts.topCareersTitle,
        'bottom-careers-title': texts.bottomCareersTitle,
        'disclaimer-title': texts.disclaimerTitle,
        'disclaimer-text': texts.disclaimerText,
        'download-btn': texts.downloadBtn,
        'restart-btn': texts.restartBtn
    };
    
    Object.keys(elementsToUpdate).forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.textContent = elementsToUpdate[id];
        }
    });
    
   
    const idealJobTitle = document.querySelector('#ideal-job-result h3');
    if (idealJobTitle) {
        idealJobTitle.textContent = translations[currentLanguage]?.careerMatchTitle || 'Career Match';
    }
    
  
    if (personalityScores && personalityScores.T_scores) {
        displayTraitScores(personalityScores.T_scores);
        displayIdealJobMatch();
        displayTopCareers();
        displayBottomCareers();
        createRadarChart(personalityScores.T_scores);
    }
}

        
        function showLanguageChangeNotice(lang) {
            const notice = document.getElementById('language-change-notice');
            if (notice) {
                const texts = translations[lang] || translations.en;
                notice.textContent = texts.languageChanged || `Language changed to ${lang}`;
                notice.style.display = 'block';
                
                setTimeout(() => {
                    notice.style.display = 'none';
                }, 2000);
            }
        }

        function initializeQuestions() {
            console.log(`üîÑ ÂàùÂßãÂåñÈóÆÈ¢ò (ËØ≠Ë®Ä: ${currentLanguage})`);
            
            const container = document.getElementById('questions-container');
            if (!container) {
                console.error('ÈóÆÈ¢òÂÆπÂô®Êú™ÊâæÂà∞');
                return;
            }
            
            
            const currentAnswers = { ...userResponses };
            
            container.innerHTML = '';
            
          
            let questions = [];
            if (appData && appData.questions && appData.questions[currentLanguage]) {
                questions = appData.questions[currentLanguage];
                console.log(`‰ªéÊï∞ÊçÆ‰∏≠Ëé∑Âèñ ${questions.length} ‰∏™ÈóÆÈ¢ò`);
            } else {
                
                questions = generateDefaultQuestions(currentLanguage, 74);
                console.log(`ÁîüÊàê ${questions.length} ‰∏™ÈªòËÆ§ÈóÆÈ¢ò`);
            }
            
         
            const neededQuestions = 74;
            if (questions.length < neededQuestions) {
                console.warn(`Âè™Êúâ ${questions.length} ‰∏™ÈóÆÈ¢òÔºåÈúÄË¶Å ${neededQuestions} ‰∏™`);
                while (questions.length < neededQuestions) {
                    questions.push(`${translations[currentLanguage]?.questionsTitle || 'Question'} ${questions.length + 1}`);
                }
            }
            
          
            questions = questions.slice(0, neededQuestions);
          
            questions.forEach((questionText, index) => {
                const questionId = `q${index}`;
                const previousValue = currentAnswers[questionId] || 4;
                
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.innerHTML = `
                    <p><strong>${index + 1}.</strong> ${questionText}</p>
                    <div class="slider-container">
                        <span style="color: #666; font-size: 14px; min-width: 20px;">1</span>
                        <input type="range" 
                               id="${questionId}" 
                               name="${questionId}"
                               min="1" 
                               max="6" 
                               value="${previousValue}"
                               class="question-slider"
                               data-index="${index}">
                        <span style="color: #666; font-size: 14px; min-width: 20px;">6</span>
                        <div class="score-display" id="score-${questionId}">${previousValue}</div>
                    </div>
                    <div class="scale-labels">
                        <span>${(translations[currentLanguage] || translations.en).scaleLabels[0]}</span>
                        <span>${(translations[currentLanguage] || translations.en).scaleLabels[2]}</span>
                        <span>${(translations[currentLanguage] || translations.en).scaleLabels[4]}</span>
                        <span>${(translations[currentLanguage] || translations.en).scaleLabels[5]}</span>
                    </div>
                `;
                
                container.appendChild(questionDiv);
                
               
                userResponses[questionId] = previousValue;
            });
            
            console.log(`‚úÖ Â∑≤ÂàõÂª∫ ${questions.length} ‰∏™ÈóÆÈ¢ò`);
           
            setTimeout(() => {
                attachSliderListeners();
            }, 50);
        }

        
        function attachSliderListeners() {
            const sliders = document.querySelectorAll('.question-slider');
            console.log(`ÁªëÂÆö ${sliders.length} ‰∏™ÊªëÂùóÁõëÂê¨Âô®`);
            
            sliders.forEach(slider => {
            
                const newSlider = slider.cloneNode(true);
                slider.parentNode.replaceChild(newSlider, slider);
                
              
                
                newSlider.addEventListener('input', function(e) {
                    const questionId = this.id;
                    const value = parseInt(this.value);
                    const display = document.getElementById(`score-${questionId}`);
                    
                    if (display) {
                        display.textContent = value;
                        display.style.animation = 'pulse 0.3s';
                        
                        const colors = ['#f44336', '#FF9800', '#FFC107', '#8BC34A', '#4CAF50', '#2196F3'];
                        display.style.color = colors[value - 1] || '#4CAF50';
                        
                        setTimeout(() => {
                            display.style.animation = '';
                        }, 300);
                    }
                    
                   
                    userResponses[questionId] = value;
                });
                
             
                newSlider.addEventListener('touchmove', function(e) {
                    e.preventDefault();
                });
            });
        }

     
        function setupEventListeners() {
            console.log('ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®...');
 
            const languageSelect = document.getElementById('language-select');
            if (languageSelect) {
                languageSelect.addEventListener('change', function(e) {
                    currentLanguage = this.value;
                    localStorage.setItem('big5_language', currentLanguage);
                    console.log(`ËØ≠Ë®ÄÂàáÊç¢Ëá≥: ${currentLanguage}`);
                    
                    updateLanguageUI();


                    // Â¶ÇÊûúÁªìÊûúÈ°µÈù¢Ê≠£Âú®ÊòæÁ§∫Ôºå‰πüË¶ÅÊõ¥Êñ∞ÁªìÊûúÈ°µÈù¢ÁöÑËØ≠Ë®Ä
                    const resultsDiv = document.getElementById('results');
                    if (resultsDiv && resultsDiv.style.display !== 'none') {
            updateResultsLanguage();
        }

                    showLanguageChangeNotice(currentLanguage);
                });
                
            
                languageSelect.value = currentLanguage;
            }
            
      
            const form = document.getElementById('personality-form');
            if (form) {
                form.addEventListener('submit', handleFormSubmit);
            }
            
    
            const ageInput = document.getElementById('age');
            if (ageInput) {
                ageInput.addEventListener('input', function() {
                    const age = parseInt(this.value);
                    const warning = document.getElementById('age-warning');
                    if (age < 18 || age > 70) {
                        warning.style.display = 'block';
                    } else {
                        warning.style.display = 'none';
                    }
                });
            }
            
 
            const idealJobInput = document.getElementById('ideal-job');
            if (idealJobInput) {
                idealJobInput.addEventListener('input', function() {
                    const warning = document.getElementById('ideal-job-warning');
                    if (this.value.trim() === '') {
                        warning.style.display = 'block';
                    } else {
                        warning.style.display = 'none';
                    }
                });
            }
            
            console.log('‚úÖ ‰∫ã‰ª∂ÁõëÂê¨Âô®ËÆæÁΩÆÂÆåÊàê');
        }

     
        function handleFormSubmit(e) {
            e.preventDefault();
            console.log('Ë°®ÂçïÊèê‰∫§Â§ÑÁêÜ');
            
            if (!validateForm()) {
                return;
            }
            
       
            showLoading(true);
            

            setTimeout(() => {
                const results = processFormData();
                showLoading(false);
                showResults(results);
            }, 1500);
        }


        function validateForm() {
            let isValid = true;
   
            const age = parseInt(document.getElementById('age').value);
            const ageWarning = document.getElementById('age-warning');
            if (age < 18 || age > 70) {
                ageWarning.style.display = 'block';
                isValid = false;
            } else {
                ageWarning.style.display = 'none';
            }
            
      
            const idealJob = document.getElementById('ideal-job').value.trim();
            const idealJobWarning = document.getElementById('ideal-job-warning');
            if (!idealJob) {
                idealJobWarning.style.display = 'block';
                isValid = false;
            } else {
                idealJobWarning.style.display = 'none';
            }
            
        
            const questionsWarning = document.getElementById('questions-warning');
            const allAnswered = Object.keys(userResponses).length >= 74 && 
                              Object.values(userResponses).every(v => v >= 1 && v <= 6);
            
            if (!allAnswered) {
                questionsWarning.style.display = 'block';
                isValid = false;
            } else {
                questionsWarning.style.display = 'none';
            }
            
            return isValid;
        }

        function showLoading(show) {
            const loadingDiv = document.getElementById('loading');
            const formDiv = document.getElementById('personality-form');
            const resultsDiv = document.getElementById('results');
            
            if (show) {
                loadingDiv.style.display = 'block';
                formDiv.style.display = 'none';
                resultsDiv.style.display = 'none';
            } else {
                loadingDiv.style.display = 'none';
            }
        }

        function processFormData() {
            console.log('Â§ÑÁêÜË°®ÂçïÊï∞ÊçÆ...');
            
            
            const bigFiveResults = calculateBigFiveScores();
            personalityScores = bigFiveResults;
            
            
            calculateJobRecommendations(bigFiveResults.T_scores);
            
            return bigFiveResults;
        }

        
        function calculateBigFiveScores() {
            const gender = document.getElementById('gender').value;
            const age = parseInt(document.getElementById('age').value);
            
            
            let normGroup;
            if (gender === "Female") {
                normGroup = age < 35 ? 1 : 2;
            } else {
                normGroup = age < 35 ? 3 : 4;
            }
            
            
            const responses = [];
            for (let i = 0; i < 74; i++) {
                responses.push(userResponses[`q${i}`] || 4);
            }
            
            
            let T_scores = [50, 50, 50, 50, 50];
            
            if (appData && appData.mean_norms && appData.sd_norms && appData.weights) {
                const mu = appData.mean_norms[normGroup] || Array(74).fill(4.0);
                const sigma = appData.sd_norms[normGroup] || Array(74).fill(1.0);
                const weights = appData.weights;
                
                
                const Z = responses.map((response, idx) => {
                    return (response - mu[idx]) / sigma[idx];
                });
                
                
                let big5Scores = [0, 0, 0, 0, 0];
                for (let i = 0; i < Z.length; i++) {
                    for (let j = 0; j < 5; j++) {
                        big5Scores[j] += Z[i] * weights[i][j];
                    }
                }
                
                
                T_scores = big5Scores.map(score => Math.max(20, Math.min(80, Math.round(10 * score + 50))));
            }
            
            console.log('Â§ß‰∫î‰∫∫Ê†ºÂàÜÊï∞:', T_scores);
            
            return {
                T_scores: T_scores,
                normGroup: normGroup,
                raw_responses: responses
            };
        }

        
        // Ê®°ÂûãÂú®ËøôÈáå
        class OptimizedJobRecommenderMLP {
    constructor() {
        this.inputDim = 5;
        this.hiddenDim = 128;
        this.outputDim = 263; // ËÅå‰∏öÊï∞Èáè
        
        // ‰ΩøÁî®Á®≥ÂÆöÂàùÂßãÂåñ
        this.initializeWeights();
        
        console.log('‰ºòÂåñÁâàMLPÊ®°ÂûãÂàùÂßãÂåñÂÆåÊàê');
    }
    
// ËøôÈáåÈáç
    initializeWeights() {
        // Á¨¨‰∏ÄÂ±ÇÔºöHeÂàùÂßãÂåñÔºàÈÄÇÂêàReLUÔºâ
        this.weights1 = this.initializeLayer(this.inputDim, this.hiddenDim, 'first');
        this.bias1 = Array(this.hiddenDim).fill(0.1); // Â∞èÁöÑÊ≠£ÂÅèÁΩÆÈÅøÂÖçÊ≠ª‰∫°ReLU
        
    
        this.weights2 = this.initializeLayer(this.hiddenDim, this.outputDim, 'second');
        this.bias2 = Array(this.outputDim).fill(0);
    }
    
  
    initializeLayer(inputSize, outputSize, layerType) {
        const weights = [];
        let scale;
        
        if (layerType === 'first') {
            // HeÂàùÂßãÂåñÔºöstd = sqrt(2/inputSize)
            scale = Math.sqrt(2.0 / inputSize);
        } else {
   
            scale = Math.sqrt(1.0 / inputSize);
        }
        
        for (let i = 0; i < inputSize; i++) {
            weights[i] = [];
            for (let j = 0; j < outputSize; j++) {
             
                weights[i][j] = this.gaussianRandom(0, scale);
            }
        }
        
        return weights;
    }
    

    gaussianRandom(mean = 0, stdev = 1) {
        let u = 0, v = 0;
        while (u === 0) u = Math.random();
        while (v === 0) v = Math.random();
        return mean + stdev * Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
    }
    

    forward(x) {
      
        if (x.length !== this.inputDim) {
            console.error(`ËæìÂÖ•Áª¥Â∫¶‰∏çÂåπÈÖç: ÊúüÊúõ${this.inputDim}, ÂÆûÈôÖ${x.length}`);
            return Array(this.outputDim).fill(0);
        }
     
        const hidden = this.linear(x, this.weights1, this.bias1);
        const hiddenRelu = this.relu(hidden);
        
      
        const output = this.linear(hiddenRelu, this.weights2, this.bias2);
        
        return output;
    }
    

    linear(input, weights, bias) {
        const outputSize = weights[0].length;
        const output = new Array(outputSize);
        
        for (let i = 0; i < outputSize; i++) {
            let sum = bias[i];
            for (let j = 0; j < input.length; j++) {
                sum += input[j] * weights[j][i];
            }
            output[i] = sum;
        }
        
        return output;
    }
    

    relu(arr) {
        return arr.map(val => Math.max(0, val));
    }
}






        function calculateJobRecommendations(T_scores) {
    console.log('=== ÂºÄÂßãËÅå‰∏öÂåπÈÖçÂ∫¶ËÆ°ÁÆóÔºà‰ºòÂåñÁâàÔºâ ===');
    
    if (!appData) {
        console.error('Êï∞ÊçÆÊú™Âä†ËΩΩ');
        return;
    }
    
    const { 
        scaled_features,  // ËÅå‰∏öÁâπÂæÅÁü©Èòµ (263√ó5)
        pca_weights,      // Âä†ÊùÉÊ¨ßÂá†ÈáåÂæóÊùÉÈáç
        job_translations, // ËÅå‰∏öÂêçÁß∞ÁøªËØë
        job_codes         // ËÅå‰∏ö‰ª£Á†Å
    } = appData;
    
    const jobNames = job_translations?.[currentLanguage] || job_translations?.en || [];
    
    jobRecommendations = [];
    
    //TÂàÜÊï∞‚ÜíZÂàÜÊï∞
    const userScaled = T_scores.map(score => (score - 50) / 10);
    console.log('Ê†áÂáÜÂåñÁî®Êà∑ÁâπÂæÅ:', userScaled.map(v => v.toFixed(3)));
    
    // MLP
    const mlpPredictions = calculateMLPPredictions(userScaled);
    
    // Áõ∏‰ººÂ∫¶
    const similarities = calculateWeightedEuclideanSimilarity(userScaled, scaled_features, pca_weights);
    
    // ÁªºÂêàÂàÜÊï∞
    const allScores = calculateCompositeScores(similarities, mlpPredictions);
    
    //ËÅå‰∏öÊé®Ëçê
    buildJobRecommendations(allScores, jobNames, job_codes, similarities, mlpPredictions);
    
    //  ÊéíÂ∫èÔºàÈôçÁöÑÔºâ
    jobRecommendations.sort((a, b) => b.score - a.score);
    
    analyzeRecommendationResults();
    
    console.log('=== ËÅå‰∏öÂåπÈÖçÂ∫¶ËÆ°ÁÆóÂÆåÊàê ===');
    return jobRecommendations;
}


function calculateMLPPredictions(userScaled) {
    console.log('ËÆ°ÁÆóMLPÈ¢ÑÊµãÔºà‰ºòÂåñÁâàÔºâ...');
    
    const mlp = new OptimizedJobRecommenderMLP();
    const rawOutput = mlp.forward(userScaled);
    
    // Â∫îÁî®softmaxÊïàÊûúÔºàÊ®°ÊãüÊ¶ÇÁéáÂàÜÂ∏ÉÔºâ
    const softmaxOutput = softmax(rawOutput);
    
    console.log(`MLPÈ¢ÑÊµãËåÉÂõ¥: ${Math.min(...softmaxOutput).toFixed(4)} - ${Math.max(...softmaxOutput).toFixed(4)}`);
    console.log(`MLPÈ¢ÑÊµãÂùáÂÄº: ${(softmaxOutput.reduce((a,b)=>a+b)/softmaxOutput.length).toFixed(4)}`);
    
    return softmaxOutput;
}


function softmax(arr) {
    // Êï∞ÂÄºÁ®≥ÂÆöÁâàÊú¨ÔºöÂáèÂéªÊúÄÂ§ßÂÄº
    const maxVal = Math.max(...arr);
    const exps = arr.map(val => Math.exp(val - maxVal));
    const sumExps = exps.reduce((a, b) => a + b, 0);
    
    return exps.map(exp => exp / sumExps);
}


function calculateWeightedEuclideanSimilarity(userScaled, jobFeatures, weights) {
    console.log('ËÆ°ÁÆóÂä†ÊùÉÊ¨ßÂá†ÈáåÂæóÁõ∏‰ººÂ∫¶...');
    
    const similarities = [];
    const distances = [];
    
    for (let i = 0; i < jobFeatures.length; i++) {
        const jobVector = jobFeatures[i];
  
        let distance = 0;
        
        if (weights && Array.isArray(weights[0])) {
            for (let j = 0; j < userScaled.length; j++) {
                let dimDist = 0;
                for (let k = 0; k < userScaled.length; k++) {
                    const diff = jobVector[k] - userScaled[k];
                    dimDist += weights[j][k] * diff * diff;
                }
                distance += dimDist;
            }
        } else if (weights && weights.length === userScaled.length) {
            // ÊùÉÈáçÂêëÈáè (5√ó1)
            for (let j = 0; j < userScaled.length; j++) {
                const diff = jobVector[j] - userScaled[j];
                distance += (weights[j] || 1) * diff * diff;
            }
        } else {
            for (let j = 0; j < userScaled.length; j++) {
                const diff = jobVector[j] - userScaled[j];
                distance += diff * diff;
            }
        }
        
        distance = Math.sqrt(distance);
        distances.push(distance);
    }
    
    const maxDist = Math.max(...distances);
    const minDist = Math.min(...distances);
    const range = maxDist - minDist;
    
    console.log(`Ë∑ùÁ¶ªÁªüËÆ°: ÊúÄÂ∞èÂÄº=${minDist.toFixed(4)}, ÊúÄÂ§ßÂÄº=${maxDist.toFixed(4)}, ËåÉÂõ¥=${range.toFixed(4)}`);
    
    if (range < 1e-10) {
        return distances.map(() => 1);
    }
    
    const similarityScores = distances.map(dist => {
        const normalized = (dist - minDist) / range;
        return 1 - normalized;
    });
    
    console.log(`Áõ∏‰ººÂ∫¶ËåÉÂõ¥: ${Math.min(...similarityScores).toFixed(3)} - ${Math.max(...similarityScores).toFixed(3)}`);
    
    return similarityScores;
}

function calculateCompositeScores(similarities, mlpPredictions) {
    console.log('ËÆ°ÁÆóÁªºÂêàÂàÜÊï∞...');
    
    if (similarities.length !== mlpPredictions.length) {
        console.error(`Áª¥Â∫¶‰∏çÂåπÈÖç: Áõ∏‰ººÂ∫¶${similarities.length}, MLPÈ¢ÑÊµã${mlpPredictions.length}`);
        return similarities.map(() => 50);
    }
    
    const compositeScores = [];

    for (let i = 0; i < similarities.length; i++) {
        const score = similarities[i] * mlpPredictions[i];
        compositeScores.push(score);
    }
    
    const minScore = Math.min(...compositeScores);
    const maxScore = Math.max(...compositeScores);
    const range = maxScore - minScore;
    
    if (range < 1e-10) {
        return compositeScores.map(() => 50);
    }
    
    const normalizedScores = compositeScores.map(score => {
        return Math.round(((score - minScore) / range) * 100);
    });
    
    console.log(`ÁªºÂêàÂàÜÊï∞ËåÉÂõ¥: ${Math.min(...normalizedScores)} - ${Math.max(...normalizedScores)}`);
    console.log(`ÁªºÂêàÂàÜÊï∞ÂùáÂÄº: ${(normalizedScores.reduce((a,b)=>a+b)/normalizedScores.length).toFixed(1)}`);
    
    return normalizedScores;
}

function buildJobRecommendations(scores, jobNames, jobCodes, similarities, mlpPredictions) {
    jobRecommendations = [];
    
    for (let i = 0; i < scores.length; i++) {
        jobRecommendations.push({
            name: getJobName(i),
            code: jobCodes?.[i] || `J${1000 + i}`,
            score: scores[i],
            match: scores[i],
            similarity: similarities ? Math.round(similarities[i] * 100) : 0,
            mlp_score: mlpPredictions ? Math.round(mlpPredictions[i] * 100) : 0,
            index: i,
            rank: 0
        });
    }
    
    console.log(`ÊûÑÂª∫‰∫Ü ${jobRecommendations.length} ‰∏™ËÅå‰∏öÊé®Ëçê`);
}

function analyzeRecommendationResults() {
    if (jobRecommendations.length === 0) {
        console.warn('Ê≤°ÊúâËÅå‰∏öÊé®ËçêÁªìÊûú');
        return;
    }

    jobRecommendations.forEach((job, index) => {
        job.rank = index + 1;
    });

    const scores = jobRecommendations.map(j => j.match);
    const stats = {
        total: jobRecommendations.length,
        avg: scores.reduce((a, b) => a + b, 0) / scores.length,
        min: Math.min(...scores),
        max: Math.max(...scores),
        std: Math.sqrt(scores.reduce((sum, score) => sum + Math.pow(score - scores.reduce((a,b)=>a+b)/scores.length, 2), 0) / scores.length)
    };
    
    // ÂâçÂçÅÂíåÂÄíÊï∞ÂâçÂçÅ
    const top10 = jobRecommendations.slice(0, 10);
    const bottom10 = jobRecommendations.slice(-10);
    
    stats.top10Avg = top10.reduce((sum, job) => sum + job.match, 0) / 10;
    stats.bottom10Avg = bottom10.reduce((sum, job) => sum + job.match, 0) / 10;
    
    console.log(' Êé®ËçêÁªìÊûúÂàÜÊûê:');
    console.log(`  ÊÄªËÅå‰∏öÊï∞: ${stats.total}`);
    console.log(`  Âπ≥ÂùáÂåπÈÖçÂ∫¶: ${stats.avg.toFixed(1)}% ¬± ${stats.std.toFixed(1)}%`);
    console.log(`  ÂåπÈÖçÂ∫¶ËåÉÂõ¥: ${stats.min}% - ${stats.max}%`);
    console.log(`  Ââç10ÂêçÂπ≥Âùá: ${stats.top10Avg.toFixed(1)}%`);
    console.log(`  Âêé10ÂêçÂπ≥Âùá: ${stats.bottom10Avg.toFixed(1)}%`);
    
  
    if (stats.top10Avg <= stats.bottom10Avg) {
        console.warn('‚ö†Ô∏è Ê≥®ÊÑèÔºöÂâç10ÂêçÂπ≥ÂùáÂàÜ‰∏çÈ´ò‰∫éÂêé10ÂêçÔºåÂèØËÉΩÂ≠òÂú®ËÆ°ÁÆóÈóÆÈ¢ò');
    }
    
 
    console.log('üèÜ Ââç3ÂêçËÅå‰∏ö:');
    top10.slice(0, 3).forEach((job, i) => {
        console.log(`  ${i+1}. ${job.name} - ${job.match}% (Áõ∏‰ººÂ∫¶:${job.similarity}%, MLP:${job.mlp_score}%)`);
    });
    
    console.log('‚ö†Ô∏è Âêé3ÂêçËÅå‰∏ö:');
    bottom10.slice(-3).forEach((job, i) => {
        const rank = jobRecommendations.length - 3 + i + 1;
        console.log(`  ${rank}. ${job.name} - ${job.match}% (Áõ∏‰ººÂ∫¶:${job.similarity}%, MLP:${job.mlp_score}%)`);
    });
}


function getJobName(jobIndex) {
    if (!appData) return `ËÅå‰∏ö ${jobIndex + 1}`;
    
    // ‰ºòÂÖà‰ΩøÁî® job_translations ‰∏≠ÁöÑÂ§öËØ≠Ë®ÄÊï∞ÊçÆ
    if (appData.job_translations && 
        appData.job_translations[currentLanguage] && 
        appData.job_translations[currentLanguage][jobIndex]) {
        return appData.job_translations[currentLanguage][jobIndex];
    }
    
    // ÂêéÂ§áÔºö‰ΩøÁî®Ëã±ÊñáÊï∞ÊçÆ
    if (appData.job_translations && appData.job_translations.en && appData.job_translations.en[jobIndex]) {
        return appData.job_translations.en[jobIndex];
    }
    
    // ÊúÄÂêéÁöÑÂêéÂ§áÔºö‰ΩøÁî® job_names
    if (appData.job_names && appData.job_names[jobIndex]) {
        return appData.job_names[jobIndex];
    }
    
    return `ËÅå‰∏ö ${jobIndex + 1}`;
}


function displayTopCareers() {
    const container = document.getElementById('top-careers');
    if (!container) return;
    
    container.innerHTML = '';
    
    const topJobs = jobRecommendations.slice(0, 10);
    
    if (topJobs.length === 0) {
        const noDataText = translations[currentLanguage]?.noCareerData || 'ÊöÇÊó†ËÅå‰∏öÊé®ËçêÊï∞ÊçÆ';
        container.innerHTML = `
            <div class="career-item top" style="grid-column: 1 / -1; text-align: center; padding: 20px;">
                <p style="color: #666; font-style: italic;">${noDataText}</p>
            </div>
        `;
        return;
    }
    
    topJobs.forEach((job, index) => {

        const jobName = getJobName(job.index);
        
        const div = document.createElement('div');
        div.className = 'career-item top';
        div.innerHTML = `
            <div style="display: flex; align-items: center; margin-bottom: 12px;">
                <div class="rank" style="background: #4CAF50; color: white; width: 32px; height: 32px; 
                     border-radius: 50%; text-align: center; line-height: 32px; font-weight: bold; 
                     margin-right: 12px;">${index + 1}</div>
                <div style="flex-grow: 1;">
                    <strong style="display: block; font-size: 16px; color: #333; margin-bottom: 4px;">${jobName}</strong>
                    <small style="color: #666; font-size: 12px;">‰ª£Á†Å: ${job.code}</small>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div>
                    <div style="color: #4CAF50; font-weight: bold; font-size: 20px;">${job.match}%</div>
                    <div style="font-size: 11px; color: #888;">ÁªºÂêàÂåπÈÖçÂ∫¶</div>
                </div>
                
            </div>
            
      
            <div style="display: flex; justify-content: space-between; font-size: 11px; color: #666; margin-top: 8px;">
                
                
            </div>
            
          
            <div style="margin-top: 10px; height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden;">
                <div style="height: 100%; width: ${job.match}%; background: #4CAF50; 
                     border-radius: 3px; transition: width 0.5s ease;"></div>
            </div>
        `;
        container.appendChild(div);
    });
}


function displayBottomCareers() {
    const container = document.getElementById('bottom-careers');
    if (!container) return;
    
    container.innerHTML = '';
    
    const bottomJobs = jobRecommendations.slice(-10);
    
    if (bottomJobs.length === 0) {
        const noDataText = translations[currentLanguage]?.noCareerData || 'ÊöÇÊó†ËÅå‰∏öÊï∞ÊçÆ';
        container.innerHTML = `
            <div class="career-item bottom" style="grid-column: 1 / -1; text-align: center; padding: 20px;">
                <p style="color: #666; font-style: italic;">${noDataText}</p>
            </div>
        `;
        return;
    }
    

    const reversedBottomJobs = bottomJobs.slice().reverse();
    
    reversedBottomJobs.forEach((job, index) => {
        const displayRank = index + 1; // 1-10ÔºåË°®Á§∫‰∏çÂêàÈÄÇÁ®ãÂ∫¶ÊéíÂêç
        
        const div = document.createElement('div');
        div.className = 'career-item bottom';
        div.innerHTML = `
            <div style="display: flex; align-items: center; margin-bottom: 12px;">
                <div class="rank" style="background: #f44336; color: white; width: 32px; height: 32px; 
                     border-radius: 50%; text-align: center; line-height: 32px; font-weight: bold; 
                     margin-right: 12px;">${displayRank}</div>
                <div style="flex-grow: 1;">
                    <strong style="display: block; font-size: 16px; color: #333; margin-bottom: 4px;">${getJobName(job.index)}</strong>
                    <small style="color: #666; font-size: 12px;">‰ª£Á†Å: ${job.code}</small>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div>
                    <div style="color: #f44336; font-weight: bold; font-size: 20px;">${job.match}%</div>
                    <div style="font-size: 11px; color: #888;">ÁªºÂêàÂåπÈÖçÂ∫¶</div>
                </div>
                
            </div>
            
            <!-- ÂàÜËß£ÂàÜÊï∞ -->
            <div style="text-align: center; font-size: 11px; color: #666; margin-top: 8px;">
                
            </div>
            
            <!-- ËøõÂ∫¶Êù° -->
            <div style="margin-top: 10px; height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden;">
                <div style="height: 100%; width: ${job.match}%; background: #f44336; 
                     border-radius: 3px; transition: width 0.5s ease;"></div>
            </div>
        `;
        container.appendChild(div);
    });
}

function showResults(results) {
    console.log(' ÊòæÁ§∫ÁªìÊûúÈ°µÈù¢...');

    document.getElementById('personality-form').style.display = 'none';
    document.getElementById('loading').style.display = 'none';
    const resultsDiv = document.getElementById('results');
    resultsDiv.style.display = 'block';

    displayTraitScores(results.T_scores);

    displayTopCareers();
    displayBottomCareers();
    

    // Èõ∑ËææÂõæÂú®ËøôÈáå
    createRadarChart(results.T_scores);
    updateResultsLanguage();
    
    resultsDiv.scrollIntoView({ behavior: 'smooth' });
}

function displayTraitScores(T_scores) {
    const container = document.getElementById('trait-scores-container');
    if (!container) return;

    const traitNames = {
        'en': ['Neuroticism', 'Extraversion', 'Openness', 'Agreeableness', 'Conscientiousness'],
        'zh': ['Á•ûÁªèË¥®', 'Â§ñÂêëÊÄß', 'ÂºÄÊîæÊÄß', 'ÂÆú‰∫∫ÊÄß', 'Â∞ΩË¥£ÊÄß'],
        'es': ['Neuroticismo', 'Extraversi√≥n', 'Apertura', 'Amabilidad', 'Conciencia'],
        'fr': ['N√©vrosisme', 'Extraversion', 'Ouverture', 'Amabilit√©', 'Conscienciosit√©'],
        'ru': ['–ù–µ–≤—Ä–æ—Ç–∏–∑–º', '–≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—è', '–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å', '–î–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', '–°–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å'],
        'ar': ['ÿßŸÑÿ∂ŸäŸÇ ÿßŸÑÿπÿµÿ®Ÿä', 'ÿßŸÑÿßŸÜŸÅÿ™ÿßÿ≠', 'ÿßŸÑÿßŸÜÿ®ÿ≥ÿßÿ∑Ÿäÿ©', 'ÿßŸÑÿ™ÿπÿßÿ∑ŸÅ', 'ÿßŸÑÿ∂ŸÖŸäÿ± ÿßŸÑŸÖŸáŸÜŸä']
    };
    
    const names = traitNames[currentLanguage] || traitNames.en;
    
    let html = '';
    names.forEach((name, index) => {
        const score = T_scores[index];
        let color = '#4CAF50'; // ÈªòËÆ§ÁªøËâ≤

        if (score < 35) color = '#f44336'; // Á∫¢Ëâ≤
        else if (score < 45) color = '#FF9800'; // Ê©ôËâ≤
        else if (score < 55) color = '#FFC107'; // ÈªÑËâ≤
        else if (score < 65) color = '#8BC34A'; // ÊµÖÁªø
        // 55-65Áî®ÁªøËâ≤
        else if (score > 65) color = '#2196F3'; // ËìùËâ≤
        
        html += `
            <div class="trait-score">
                <div class="trait-name">${name}</div>
                <div class="trait-value" style="border-color: ${color}; color: ${color};">
                    ${score}
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}


function displayIdealJobMatch() {
    const idealJobInput = document.getElementById('ideal-job').value.trim();
    const idealJobText = document.getElementById('ideal-job-text');
    const matchScore = document.getElementById('match-score');
    
    if (!idealJobInput || !idealJobText || !matchScore) return;

    let bestMatch = null;
    let bestScore = -1;
    
    if (jobRecommendations && jobRecommendations.length > 0) {
        for (let job of jobRecommendations) {
            const jobName = getJobName(job.index);
            if (jobName.toLowerCase().includes(idealJobInput.toLowerCase()) ||
                idealJobInput.toLowerCase().includes(jobName.toLowerCase())) {
                bestMatch = { ...job, name: jobName };
                bestScore = job.match;
                break;
            }
        }
  
        if (!bestMatch) {
            const firstJob = jobRecommendations[0];
            bestMatch = {
                ...firstJob,
                name: getJobName(firstJob.index)
            };
            bestScore = firstJob.match;
        }
        
        bestScore = bestMatch.match;

        const resultTexts = {
            'en': "The career closest to your ideal is: ",
            'zh': "ÊÇ®ÁöÑÁêÜÊÉ≥ËÅå‰∏öÊúÄÁõ∏ËøëÁöÑÊòØÔºö",
            'es': "La carrera m√°s cercana a su ideal es: ",
            'fr': "Le m√©tier le plus proche de votre id√©al est : ",
            'ru': "–°–∞–º–∞—è –±–ª–∏–∑–∫–∞—è –∫ –≤–∞—à–µ–π –∏–¥–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏—è: ",
            'ar': "ÿ£ŸÇÿ±ÿ® ŸÖŸáŸÜÿ© ÿ•ŸÑŸâ ŸÖŸáŸÜÿ™ŸÉ ÿßŸÑŸÖÿ´ÿßŸÑŸäÿ© ŸáŸä: "
        };
        
        const text = resultTexts[currentLanguage] || resultTexts.en;
        
        idealJobText.innerHTML = `
            <p style="margin-bottom: 10px; font-size: 18px;">${text}</p>
            <div class="job-name-highlight">${bestMatch.name}</div>
            <p style="margin-top: 10px; font-size: 14px; opacity: 0.9;">
                ‰ª£Á†Å: ${bestMatch.code} | ÊéíÂêç: ${bestMatch.rank}/${jobRecommendations.length}
            </p>
        `;
        
        matchScore.textContent = `${bestScore}%`;
        
        if (bestScore >= 70) {
            matchScore.style.color = '#4CAF50';
        } else if (bestScore >= 50) {
            matchScore.style.color = '#FF9800';
        } else {
            matchScore.style.color = '#f44336';
        }
    }
}

function createRadarChart(T_scores) {
    const chartDiv = document.getElementById('radar-chart');
    if (!chartDiv) return;

    const traitNames = {
        'en': ['Neuroticism', 'Extraversion', 'Openness', 'Agreeableness', 'Conscientiousness'],
        'zh': ['Á•ûÁªèË¥®', 'Â§ñÂêëÊÄß', 'ÂºÄÊîæÊÄß', 'ÂÆú‰∫∫ÊÄß', 'Â∞ΩË¥£ÊÄß'],
        'es': ['Neuroticismo', 'Extraversi√≥n', 'Apertura', 'Amabilidad', 'Conciencia'],
        'fr': ['N√©vrosisme', 'Extraversion', 'Ouverture', 'Amabilit√©', 'Conscienciosit√©'],
        'ru': ['–ù–µ–≤—Ä–æ—Ç–∏–∑–º', '–≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Å–∏—è', '–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å', '–î–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', '–°–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å'],
        'ar': ['ÿßŸÑÿ∂ŸäŸÇ ÿßŸÑÿπÿµÿ®Ÿä', 'ÿßŸÑÿßŸÜŸÅÿ™ÿßÿ≠', 'ÿßŸÑÿßŸÜÿ®ÿ≥ÿßÿ∑Ÿäÿ©', 'ÿßŸÑÿ™ÿπÿßÿ∑ŸÅ', 'ÿßŸÑÿ∂ŸÖŸäÿ± ÿßŸÑŸÖŸáŸÜŸä']
    };
    
    const names = traitNames[currentLanguage] || traitNames.en;
    
    const data = [{
        type: 'scatterpolar',
        r: T_scores,
        theta: names,
        fill: 'toself',
        name: 'Your Scores',
        fillcolor: 'rgba(76, 175, 80, 0.3)',
        line: {
            color: 'rgb(76, 175, 80)',
            width: 2
        },
        marker: {
            color: 'rgb(76, 175, 80)',
            size: 8
        }
    }];
    
    const layout = {
        polar: {
            radialaxis: {
                visible: true,
                range: [20, 80],
                tickvals: [20, 35, 50, 65, 80],
                ticktext: ['20', '35', '50', '65', '80'],
                gridcolor: '#e0e0e0',
                linecolor: '#ccc'
            },
            angularaxis: {
                gridcolor: '#e0e0e0',
                linecolor: '#ccc'
            },
            bgcolor: 'rgba(255,255,255,0.5)'
        },
        showlegend: false,
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        margin: {
            l: 80,
            r: 80,
            t: 30,
            b: 30
        }
    };
    
    const config = {
        responsive: true,
        displayModeBar: false
    };

    chartDiv.innerHTML = '';

    Plotly.newPlot(chartDiv, data, layout, config);

    addChartLegend(chartDiv);
}

function addChartLegend(chartDiv) {
    const legend = document.createElement('div');
    legend.style.cssText = `
        margin-top: 20px;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 15px;
    `;
    
    const ranges = [
        { min: 20, max: 35, color: '#f44336', label: 'Very Low' },
        { min: 35, max: 45, color: '#FF9800', label: 'Low' },
        { min: 45, max: 55, color: '#FFC107', label: 'Average' },
        { min: 55, max: 65, color: '#8BC34A', label: 'High' },
        { min: 65, max: 80, color: '#2196F3', label: 'Very High' }
    ];
    
    const legendLabels = {
        'en': ['Very Low', 'Low', 'Average', 'High', 'Very High'],
        'zh': ['ÈùûÂ∏∏‰Ωé', '‰Ωé', '‰∏≠Á≠â', 'È´ò', 'ÈùûÂ∏∏È´ò'],
        'es': ['Muy Bajo', 'Bajo', 'Promedio', 'Alto', 'Muy Alto'],
        'fr': ['Tr√®s Bas', 'Bas', 'Moyen', '√âlev√©', 'Tr√®s √âlev√©'],
        'ru': ['–û—á–µ–Ω—å –Ω–∏–∑–∫–∏–π', '–ù–∏–∑–∫–∏–π', '–°—Ä–µ–¥–Ω–∏–π', '–í—ã—Å–æ–∫–∏–π', '–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π'],
        'ar': ['ŸÖŸÜÿÆŸÅÿ∂ ÿ¨ÿØÿß', 'ŸÖŸÜÿÆŸÅÿ∂', 'ŸÖÿ™Ÿàÿ≥ÿ∑', 'ŸÖÿ±ÿ™ŸÅÿπ', 'ŸÖÿ±ÿ™ŸÅÿπ ÿ¨ÿØÿß']
    };
    
    const labels = legendLabels[currentLanguage] || legendLabels.en;
    
    ranges.forEach((range, index) => {
        const item = document.createElement('div');
        item.style.cssText = `
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #666;
        `;
        
        const colorBox = document.createElement('div');
        colorBox.style.cssText = `
            width: 12px;
            height: 12px;
            background: ${range.color};
            border-radius: 2px;
        `;
        
        item.appendChild(colorBox);
        item.appendChild(document.createTextNode(`${range.min}-${range.max}: ${labels[index]}`));
        legend.appendChild(item);
    });
    
    chartDiv.parentNode.appendChild(legend);
}

function updateResultsLanguage() {

// ÁîüÊàêPDFÊä•Âëä
function generatePDF() {
    const element = document.getElementById('results');
    if (!element) {
        alert('ËØ∑ÂÖàÂÆåÊàêÊµãËØïÂπ∂Êü•ÁúãÁªìÊûú„ÄÇ');
        return;
    }

    // ÊòæÁ§∫ÁîüÊàêÊèêÁ§∫
    const originalText = document.getElementById('download-btn').textContent;
    const btn = document.getElementById('download-btn');
    btn.textContent = 'Ê≠£Âú®ÂáÜÂ§áÈ°µÈù¢...';
    btn.disabled = true;

    // Á≠âÂæÖÊâÄÊúâÂä®ÊÄÅÂÜÖÂÆπÂÆåÂÖ®Ê∏≤Êüì
    setTimeout(() => {
        // Âº∫Âà∂ÈáçÁªòÁ°Æ‰øùPlotlyÂõæË°®ÂÆåÂÖ®Ê∏≤Êüì
        if (window.Plotly) {
            Plotly.Plots.resize(document.getElementById('radar-chart'));
        }

        // Á≠âÂæÖÂõæË°®Ê∏≤ÊüìÂÆåÊàê
        setTimeout(() => {
            generatePDFWithCanvas(element, btn, originalText);
        }, 1000);
    }, 500);
}

function generatePDFWithCanvas(element, btn, originalText) {
        const originalStyles = fixElementStyles(element);
    
    html2canvas(element, {
        scale: 2,
        useCORS: true,
        backgroundColor: '#ffffff',
        logging: true,
        allowTaint: true,
        // ÂÖ≥ÈîÆÈÖçÁΩÆÔºöÊåâDOMÈ°∫Â∫èÊ∏≤ÊüìÔºåÂøΩÁï•z-index
        ignoreElements: (element) => false,
        onclone: function(clonedDoc) {
            // ÂÖãÈöÜÊó∂‰øÆÂ§çÊ†∑Âºè
            const clonedElement = clonedDoc.getElementById('results');
            if (clonedElement) {
                fixElementStyles(clonedElement);
                
                // Á°Æ‰øùÊâÄÊúâÂÜÖÂÆπÂèØËßÅ‰∏îÊåâÊ≠£Á°ÆÈ°∫Â∫è
                clonedElement.style.display = 'block';
                clonedElement.style.overflow = 'visible';
                clonedElement.style.position = 'relative';
                clonedElement.style.zIndex = '1';
                
                // ‰øÆÂ§çÈõ∑ËææÂõæÂÆπÂô®
                const radarChart = clonedElement.querySelector('#radar-chart');
                if (radarChart) {
                    radarChart.style.position = 'relative';
                    radarChart.style.zIndex = '2';
                }
                
                // ‰øÆÂ§çËÅå‰∏öÂç°ÁâáÈ°∫Â∫è
                const careerItems = clonedElement.querySelectorAll('.career-item');
                careerItems.forEach((item, index) => {
                    item.style.position = 'relative';
                    item.style.zIndex = (index + 3).toString();
                    item.style.breakInside = 'avoid'; // Èò≤Ê≠¢ÂàÜÈ°µÊó∂Êñ≠Ë£Ç
                });
            }
        }
    }).then(canvas => {
     
        restoreElementStyles(element, originalStyles);
    
        const imgData = canvas.toDataURL('image/jpeg', 0.95);
   
        let pdf;
        if (window.jspdf && window.jspdf.jsPDF) {
            const { jsPDF } = window.jspdf;
            pdf = new jsPDF('p', 'mm', 'a4');
        } else if (window.jsPDF) {
            pdf = new window.jsPDF('p', 'mm', 'a4');
        } else {
            throw new Error('jsPDFÂ∫ìÊú™Ê≠£Á°ÆÂä†ËΩΩ');
        }
        
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = pdf.internal.pageSize.getHeight();
        
        const imgWidth = pdfWidth - 20;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
  
        pdf.addImage(imgData, 'JPEG', 10, 10, imgWidth, imgHeight);
  
        const fileName = '‰∫∫Ê†ºÊµãËØïÊä•Âëä_' + 
            new Date().getFullYear() + 
            ('0' + (new Date().getMonth() + 1)).slice(-2) + 
            ('0' + new Date().getDate()).slice(-2) + '.pdf';
        
        pdf.save(fileName);
     
        btn.textContent = originalText;
        btn.disabled = false;
        
    }).catch(error => {
        console.error('ÁîüÊàêPDFÂ§±Ë¥•:', error);
        restoreElementStyles(element, originalStyles);
        btn.textContent = originalText;
        btn.disabled = false;
        alert('ÁîüÊàêPDFÊó∂Âá∫Èîô: ' + error.message);
    });
}

function fixElementStyles(element) {
    const originalStyles = {};
    
    // ‰øùÂ≠òÂéüÂßãÊ†∑Âºè
    originalStyles.display = element.style.display;
    originalStyles.overflow = element.style.overflow;
    originalStyles.position = element.style.position;
    originalStyles.zIndex = element.style.zIndex;
    
    // Â∫îÁî®‰øÆÂ§çÊ†∑Âºè
    element.style.display = 'block';
    element.style.overflow = 'visible';
    element.style.position = 'relative';
    element.style.zIndex = '1';
    
    // ‰øÆÂ§çÊâÄÊúâÂ≠êÂÖÉÁ¥†
    const children = element.querySelectorAll('*');
    children.forEach((child, index) => {
        // ‰øùÂ≠òÂ≠êÂÖÉÁ¥†ÂéüÂßãÊ†∑Âºè
        if (!originalStyles.children) originalStyles.children = [];
        originalStyles.children.push({
            element: child,
            position: child.style.position,
            zIndex: child.style.zIndex,
            float: child.style.float,
            display: child.style.display
        });
        
        // Â∫îÁî®‰øÆÂ§çÊ†∑Âºè
        child.style.position = 'relative';
        child.style.zIndex = (index + 2).toString();
        child.style.float = 'none';
        child.style.display = 'block';
    });
    
    return originalStyles;
}

function restoreElementStyles(element, originalStyles) {
    if (!originalStyles) return;
    
    element.style.display = originalStyles.display;
    element.style.overflow = originalStyles.overflow;
    element.style.position = originalStyles.position;
    element.style.zIndex = originalStyles.zIndex;
    
    if (originalStyles.children) {
        originalStyles.children.forEach(style => {
            if (style.element) {
                style.element.style.position = style.position;
                style.element.style.zIndex = style.zIndex;
                style.element.style.float = style.float;
                style.element.style.display = style.display;
            }
        });
    }
}


function restartTest() {
    console.log('üîÑ ÈáçÊñ∞ÂºÄÂßãÊµãËØï...');
    

    document.getElementById('results').style.display = 'none';
    document.getElementById('personality-form').style.display = 'block';
    document.getElementById('loading').style.display = 'none';
    

    document.getElementById('age').value = 25;
    document.getElementById('gender').value = 'Female';
    document.getElementById('ideal-job').value = '';

    userResponses = {};
    initializeQuestions();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}
    </script>
</body>
</html>
